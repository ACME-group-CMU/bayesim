<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Manual &#8212; bayesim 0.9.5 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Technical Background" href="bayesics.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">
          bayesim</a>
        <span class="navbar-text pull-left"><b></b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="genindex.html">Index</a></li>
                <li><a href="https://github.com/pv-lab/bayesim">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="whybayesim.html">Why bayesim?</a></li>
<li class="toctree-l1"><a class="reference internal" href="bayesics.html">Technical Background</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="futurefeatures.html">Future Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="citingbayesim.html">Citing bayesim</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Manual</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#attaching-observations">Attaching Observations</a></li>
<li><a class="reference internal" href="#defining-parameters">Defining Parameters</a></li>
<li><a class="reference internal" href="#attaching-modeled-data">Attaching Modeled Data</a></li>
<li><a class="reference internal" href="#performing-the-inference">Performing the Inference</a></li>
<li><a class="reference internal" href="#visualizing-the-output">Visualizing the Output</a><ul>
<li><a class="reference internal" href="#plotting-the-pmf">Plotting the PMF</a></li>
<li><a class="reference internal" href="#visualizing-the-grid">Visualizing the Grid</a></li>
<li><a class="reference internal" href="#comparing-the-data">Comparing the Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subdividing-the-grid">Subdividing the Grid</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a><ul>
<li><a class="reference internal" href="#saving-a-state-file">Saving a state file</a></li>
<li><a class="reference internal" href="#handling-missing-data">Handling missing data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="bayesics.html" title="Previous Chapter: Technical Background"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; Technical Background</span>
    </a>
  </li>
  <li>
    <a href="examples.html" title="Next Chapter: Examples"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">Examples &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li>
<div id="sourcelink">
  <a href="_sources/manual.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="span12 content">
      
  <div class="section" id="manual">
<h1>Manual<a class="headerlink" href="#manual" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The basic procedure of performing a parameter fit with <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> is as follows:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/flowchart_b.png"><img alt="_images/flowchart_b.png" src="_images/flowchart_b.png" style="width: 1163.4px; height: 878.4px;" /></a>
</div>
<p>On this page, we will dive into each part of this flowchart in detail to understand what is happening and what options exist to tweak <code class="docutils literal notranslate"><span class="pre">bayesim</span></code>’s behavior. The code snippets will be assuming that we are modeling a solar cell’s output current <span class="math notranslate nohighlight">\(J\)</span> with two experimental conditions: voltage <span class="math notranslate nohighlight">\(V\)</span> and temperature <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>The first step is to initialize a <a class="reference internal" href="bayesim.html#bayesim.model.Model" title="bayesim.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object. Several of the next steps can be rolled into this initialization using keywords, but the only required input is the name of the output variable. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bayesim.model</span> <span class="kn">as</span> <span class="nn">bym</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">bym</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">output_var</span><span class="o">=</span><span class="s1">&#39;J&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="attaching-observations">
<span id="attach-obs"></span><h2>Attaching Observations<a class="headerlink" href="#attaching-observations" title="Permalink to this headline">¶</a></h2>
<p>The experimental observations should reside in an HDF5 file with columns for each experimental condition and the output variable. Optionally, there may also be a column for experimental uncertainty. In addition, one should specify one of the experimental conditions (EC’s) to be plotted on the x-axis when visualizing data later on using the <code class="docutils literal notranslate"><span class="pre">ec_x_var</span></code> keyword. The data are attached using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">attach_observations</span><span class="p">(</span><span class="n">obs_data_path</span><span class="o">=</span><span class="s1">&#39;obs_data.h5&#39;</span><span class="p">,</span> <span class="n">ec_x_var</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If this column isn’t present, the <code class="docutils literal notranslate"><span class="pre">fixed_unc</span></code> keyword must be passed with a value to use as experimental uncertainty for every data point:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">attach_observations</span><span class="p">(</span><span class="n">obs_data_path</span><span class="o">=</span><span class="s1">&#39;obs_data.h5&#39;</span><span class="p">,</span> <span class="n">ec_x_var</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">fixed_unc</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, to save computational time, <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> will not import all data points, but rather attempt to maintain some minimum spacing between points such that each piece of evidence is more likely to contribute to constraining the posterior distribution. This behavior can be turned off by passing <code class="docutils literal notranslate"><span class="pre">keep_all=True</span></code> to the <a class="reference internal" href="bayesim.html#bayesim.model.Model.attach_observations" title="bayesim.model.Model.attach_observations"><code class="xref py py-meth docutils literal notranslate"><span class="pre">attach_observations()</span></code></a> function, and can be tuned using the <code class="docutils literal notranslate"><span class="pre">max_ec_x_step</span></code> and <code class="docutils literal notranslate"><span class="pre">thresh_dif_frac</span></code> keywords. <code class="docutils literal notranslate"><span class="pre">thresh_dif_frac</span></code> is given as a fraction of the range of values of the output variable and defaults to 0.01. It defines the minimum difference in output variable along the x-axis EC (at fixed values of the other EC’s) for which to save a point. <code class="docutils literal notranslate"><span class="pre">max_ec_x_step</span></code> is the largest step to take in the previously defined x-axis EC before saving a point anyway even if it <em>doesn’t</em> differ by that threshold amount, and defaults to 5% of the range of values of the x-axis EC. Let’s look at an example case where we use the default values for these parameters:</p>
<div class="figure align-center" id="id1">
<img alt="_images/import_example.png" src="_images/import_example.png" />
<p class="caption"><span class="caption-text">Note how in the ‘flatter’ region of the curve, the spacing along the x-axis of imported points is wider than in the ‘steeper’ region.</span></p>
</div>
</div>
<div class="section" id="defining-parameters">
<h2>Defining Parameters<a class="headerlink" href="#defining-parameters" title="Permalink to this headline">¶</a></h2>
<p>It is possible to predefine the parameter grid by directly constructing a <a class="reference internal" href="bayesim.html#bayesim.params.Param_list" title="bayesim.params.Param_list"><code class="xref py py-class docutils literal notranslate"><span class="pre">Param_list</span></code></a> object and passing it to the <a class="reference internal" href="bayesim.html#bayesim.model.Model" title="bayesim.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> constructor, although this is not necessary, because <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> is capable of determining these directly from the model data file (see next step). However, if one wants to use <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> to generate the list of model points that need to be simulated, this approach is useful. Consider the <a class="reference internal" href="examples.html#id"><span class="std std-ref">ideal diode</span></a> example, where the parameters to be fit were <span class="math notranslate nohighlight">\(B'\)</span> and <span class="math notranslate nohighlight">\(n\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bayesim.model</span> <span class="kn">as</span> <span class="nn">bym</span>
<span class="kn">import</span> <span class="nn">bayesim.params</span> <span class="kn">as</span> <span class="nn">byp</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">byp</span><span class="o">.</span><span class="n">Param_list</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_fit_param</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bp&#39;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;B&#39;&quot;</span><span class="p">,</span> <span class="n">val_range</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;arb.&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_fit_param</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">val_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">bym</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">pl</span><span class="p">,</span> <span class="n">output_var</span><span class="o">=</span><span class="s1">&#39;J&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The code block above sets the ranges of values, spacing (linear by default, logarithmic as an option), and number of divisions (10 by default) for the two parameters, and initializes the model object using this parameter grid. We can also set a display name for plot labeling (TeX input is accepted in this field), units (also used in plotting, defaults to ‘unitless’), and minimum width beyond which a grid box won’t be subdivided along this dimension (defaults to 1% of the value range in the appropriate spacing). Some of these parameters can also be set after data import using the <a class="reference internal" href="bayesim.html#bayesim.model.Model.set_param_info" title="bayesim.model.Model.set_param_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_param_info()</span></code></a> function, as in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">set_param_info</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;mA/cm$^2$&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">set_param_info</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="attaching-modeled-data">
<h2>Attaching Modeled Data<a class="headerlink" href="#attaching-modeled-data" title="Permalink to this headline">¶</a></h2>
<p>Next, we need to attach the modeled data. If you’re using <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> to tell your model what points to run, you can call <a class="reference internal" href="bayesim.html#bayesim.model.Model.list_model_pts_to_run" title="bayesim.model.Model.list_model_pts_to_run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">list_model_pts_to_run()</span></code></a> to write out an HDF5 file to pass to your forward model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">list_model_pts_to_run</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="s1">&#39;model_inputs.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also directly interface with your model by passing a Python callable, as in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">attach_model</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">model_data_func</span><span class="o">=</span><span class="n">model_func</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">model_func</span></code> is a callable in your namespace that accepts dictionaries of inputs, one with keys of the EC’s and one of the fitting parameters (see <a class="reference internal" href="examples.html#id"><span class="std std-ref">ideal diode</span></a> example).</p>
<p>However, typically, the model data will be precomputed and residing in an HDF5 file which will be attached to the model object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">attach_model</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">model_data_path</span><span class="o">=</span><span class="s1">&#39;model_data.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="bayesics.html#model-uncertainty"><span class="std std-ref">model uncertainty</span></a> also needs to be computed. This can be done either with a separate function call to <a class="reference internal" href="bayesim.html#bayesim.model.Model.calc_model_unc" title="bayesim.model.Model.calc_model_unc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">calc_model_unc()</span></code></a>, or in a single step when attaching the model data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">attach_model</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">model_data_path</span><span class="o">=</span><span class="s1">&#39;model_data.h5&#39;</span><span class="p">,</span> <span class="n">calc_model_unc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The model uncertainty calculation can be somewhat expensive for large grids and will be parallelized by default on Unix-based systems.</p>
</div>
<div class="section" id="performing-the-inference">
<h2>Performing the Inference<a class="headerlink" href="#performing-the-inference" title="Permalink to this headline">¶</a></h2>
<p>Once experimental and model data and their associated uncertainties have been defined and the fitting parameters either explicitly specified or determined from the data, we can do Bayesian inference! The inference is performed by the <a class="reference internal" href="bayesim.html#bayesim.model.Model.run" title="bayesim.model.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> function. Details about what calculations are actually done and what they mean can be found on the <a class="reference internal" href="bayesics.html"><span class="doc">Technical Background</span></a> page; here we will focus on the mechanics of the code.</p>
<p>First, a bounded uniform prior (equal probability in every grid box) is defined. Next, a piece of evidence (one experimental measurement, i.e. in this example a <span class="math notranslate nohighlight">\((V, T, J)\)</span> tuple) is chosen at random. The likelihood at each point in parameter space is computed conditioned on this piece of evidence as a Gaussian in the difference between the measured output and the simulated output at that point, with a standard deviation equal to the sum of the experimental error for that observation and the model uncertainty at that point:</p>
<div class="math notranslate nohighlight" id="equation-manual-0">
<span class="eqno">(1)<a class="headerlink" href="#equation-manual-0" title="Permalink to this equation">¶</a></span>\[\mathcal{P}(\{P\}|O_e(\{c\}_i)) \propto \exp\left(\frac{-(O_e(\{c\}_i)-O_m(\{P\},\{c\}_i))^2}{2(\sigma_e(\{c\}_i)+\sigma_m(\{P\},\{c\}_i))^2}\right)\]</div>
<p>In the <a class="reference internal" href="examples.html#id"><span class="std std-ref">ideal diode</span></a> example, this means more specifically that</p>
<div class="math notranslate nohighlight" id="equation-manual-1">
<span class="eqno">(2)<a class="headerlink" href="#equation-manual-1" title="Permalink to this equation">¶</a></span>\[\mathcal{P}(B',n|J_{\text{meas}}(V_i,T_i)) \propto \exp\left(\frac{-(J_{\text{meas}}(V_i,T_i)-J_{\text{mod}}(B',n,V_i,T_i))^2}{2(\sigma_\text{meas}(V_i,T_i)+\sigma_{\text{mod}}(B',n,V_i,T_i))^2}\right)\]</div>
<p>This likelihood is multiplied with the prior and normalized to compute the posterior.</p>
<p>Next, <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> will check if the posterior distribution is “concentrated” enough. This concentration is defined by two optional parameters passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code>, <code class="docutils literal notranslate"><span class="pre">th_pm</span></code> and <code class="docutils literal notranslate"><span class="pre">th_pv</span></code>, both on the interval (0,1) and defaulting to 0.9 and 0.05, respectively. The posterior is sufficiently concentrated is <code class="docutils literal notranslate"><span class="pre">th_pm</span></code> of the probability mass resides in <code class="docutils literal notranslate"><span class="pre">th_pv</span></code> of the parameter space. (Entropy-based thresholding is planned as an option for a future release)</p>
<p>If the posterior is not sufficiently concentrated, the posterior is set to the prior, another piece of evidence chosen, and another Bayesian update performed until it is. Once the concentration threshold is met, the posterior is saved and another check is done for whether enough pieces of evidence have been used. The requisite number to use is defined by the <code class="docutils literal notranslate"><span class="pre">min_num_pts</span></code> keyword in the <a class="reference internal" href="bayesim.html#bayesim.model.Model.run" title="bayesim.model.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> function and defaults to 80% of the total number of observation data points imported. If not enough points have been used, the current posterior is saved, a new uniform prior is set and the process above repeated as many times as necessary for sufficient points to be used. The final posterior is then the average of all computed posteriors. <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> will inform you how many posteriors were averaged and how many observed data points were used.</p>
</div>
<div class="section" id="visualizing-the-output">
<h2>Visualizing the Output<a class="headerlink" href="#visualizing-the-output" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">bayesim</span></code> has a variety of capacities for data visualization.</p>
<div class="section" id="plotting-the-pmf">
<h3>Plotting the PMF<a class="headerlink" href="#plotting-the-pmf" title="Permalink to this headline">¶</a></h3>
<p>Visualizing the posterior distribution (probability mass function, or PMF) is done using the <a class="reference internal" href="bayesim.html#bayesim.model.Model.visualize_probs" title="bayesim.model.Model.visualize_probs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">visualize_probs()</span></code></a> function. It takes an optional argument of a filepath to save the image, and can also highlight a specific point in the parameter space to compare to using the <code class="docutils literal notranslate"><span class="pre">true_vals</span></code> keyword.</p>
</div>
<div class="section" id="visualizing-the-grid">
<h3>Visualizing the Grid<a class="headerlink" href="#visualizing-the-grid" title="Permalink to this headline">¶</a></h3>
<p>To visualize the current state of the parameter space grid, use <a class="reference internal" href="bayesim.html#bayesim.model.Model.visualize_grid" title="bayesim.model.Model.visualize_grid"><code class="xref py py-meth docutils literal notranslate"><span class="pre">visualize_grid()</span></code></a>, which can also accept a path to save the imge as well as the <code class="docutils literal notranslate"><span class="pre">true_vals</span></code> keyword to highlight a particular point.</p>
</div>
<div class="section" id="comparing-the-data">
<h3>Comparing the Data<a class="headerlink" href="#comparing-the-data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="bayesim.html#bayesim.model.Model.comparison_plot" title="bayesim.model.Model.comparison_plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">comparison_plot()</span></code></a> function can directly compare modeled to simulated data. It will produce a number of plots with the output variable on the y-axis and the previously specified EC x-variable on the x-axis. It accepts a few optional keywords:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">ec_vals</span></code></dt>
<dd>dict or list of dict, specific experimental
conditions at which to plot (values for x-axis EC are ignored)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_ecs</span></code></dt>
<dd>int, number of (randomly chosen) EC’s at which to plot
(ignored if previous option is provided)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_param_pts</span></code></dt>
<dd>int, number of parameter space points for which to plot
modeled data (will choose the most probable)</dd>
</dl>
<p>In addition to a filepath to save the image as well as a flag to return average errors.</p>
</div>
</div>
<div class="section" id="subdividing-the-grid">
<h2>Subdividing the Grid<a class="headerlink" href="#subdividing-the-grid" title="Permalink to this headline">¶</a></h2>
<p>Once you have taken a look at your posterior PMF and compared observed and highest-probability modeled data, you’ll have a sense for whether you’d like to go to a higher fit precision by subdividing the parameter space grid. This can be done via a call to the <a class="reference internal" href="bayesim.html#bayesim.model.Model.subdivide" title="bayesim.model.Model.subdivide"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subdivide()</span></code></a> function, which accepts one optional argument of <code class="docutils literal notranslate"><span class="pre">threshold_prob</span></code>, the minimum probability for a box to have in order to be subdivided. It defaults to 0.001. <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> will then divide every grid box meeting this threshold <em>as well as every box immediately neighboring it</em> into two along every parameter dimension, unless it is already narrower than the minimum width defined for that parameter.</p>
<p><code class="docutils literal notranslate"><span class="pre">bayesim</span></code> will inform you how many boxes were subdivided and also automatically save a file of the new points that need to be simulated using the model in order to perform another inference run. This new model data can be attached exactly as described <a class="reference internal" href="#attach-obs"><span class="std std-ref">above</span></a> using the <a class="reference internal" href="bayesim.html#bayesim.model.Model.attach_observations" title="bayesim.model.Model.attach_observations"><code class="xref py py-meth docutils literal notranslate"><span class="pre">attach_observations()</span></code></a> function, and then inference can proceed again.</p>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<div class="section" id="saving-a-state-file">
<h3>Saving a state file<a class="headerlink" href="#saving-a-state-file" title="Permalink to this headline">¶</a></h3>
<p>At any point during an analysis, the state of your <a class="reference internal" href="bayesim.html#bayesim.model.Model" title="bayesim.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> object can be saved using the <a class="reference internal" href="bayesim.html#bayesim.model.Model.save_state" title="bayesim.model.Model.save_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_state()</span></code></a> function, and can be reloaded again using keywords in the <a class="reference internal" href="bayesim.html#bayesim.model.Model" title="bayesim.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> constructor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;statefile.h5&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">bym</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">load_state</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">state_file</span><span class="o">=</span><span class="s1">&#39;statefile.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is useful, e.g., if you’re working interactively and want to be able to pick up again later without rerunning all the same code, or if you’d like to continue work on a different machine.</p>
</div>
<div class="section" id="handling-missing-data">
<h3>Handling missing data<a class="headerlink" href="#handling-missing-data" title="Permalink to this headline">¶</a></h3>
<p>Sometimes things go run when running a large number of simulations. <code class="docutils literal notranslate"><span class="pre">bayesim</span></code> can handle cases where simulated data is missing (see the <a class="reference internal" href="examples.html#sns"><span class="std std-ref">SnS example</span></a>). When computing likelihoods, if the simulated data for the EC in question isn’t present, it will just use what the uniform distribution probability would be for that point. The output of the <a class="reference internal" href="bayesim.html#bayesim.model.Model.run" title="bayesim.model.Model.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> function will inform you how many times this happened on average over each Bayesian loop.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Rachel C Kurchin and Giuseppe Romano.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.<br/>
    </p>
  </div>
</footer>
  </body>
</html>